#!/usr/bin/with-contenv bash

set -euo pipefail

command="/usr/local/bin/gomplate --input-dir='$TEMPLATES_INPUT_DIR' \
                                 --output-map='$TEMPLATES_OUTPUT_DIR/{{ .in | strings.ReplaceAll \".tmpl\" \" \" }}' \
                                 --datasource='config=$CONFIG_VARS_PATH' \
                                 --datasource='secrets=$SECRET_VARS_PATH'"

# gomplate appears to not allow you to specify logger output and outputs JSON when not ran in a terminal
script --return --quiet --command "$command" /dev/null
